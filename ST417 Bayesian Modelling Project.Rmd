---
title: "ST417 Bayesian Modelling Project"
author: "Fionn McGlacken 19388186"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
install.packages("dplyr")
install.packages("stringr")
install.packages("lubridate")
library("stringr")
library("dplyr")
library("lubridate")
```

```{r}
data <- read.csv("data.csv")

# replace question column names with short-hand
# est short for estimated
new_names <- c(
  "timestamp",
  "est_time",
  "est_distance",
  "est_cost",
  "est_transport",
  "year_group",
  "time",
  "start_time",
  "distance",
  "cost",
  "transport",
  "origin")
colnames(data) <- new_names
```

```{r}
# strips data of all characters that aren't numbers, full stops or hyphens
strip_data <- function(df) {
  matcher <- "[^0-9.-]"
  cond <- grepl(matcher, df)
  stripped_rows <- str_remove_all(df[cond], matcher)
  df[cond] <- stripped_rows
  return(df)
}

# scales data that matches pattern e.g. hours to minutes
scale_data <- function(df, to_match, scalar) {
  matcher <- paste(to_match, collapse = "|")
  cond <- grepl(matcher, df)
  stripped_rows <- str_remove_all(df[cond], "[^0-9.-]")
  stripped_rows <- as.numeric(stripped_rows)
  df[cond] <- stripped_rows * scalar
  return(df)
}

# replaces range value with average of range e.g. 5-10 to 7.5
avg_range <- function(df) {
  matcher <- "^(\\d+)-(\\d+)$"
  cond <- grepl(matcher, df)
  df[cond] <- rowMeans(read.table(text = df[cond],
     sep = "-", header = FALSE), na.rm = TRUE)
  return(df)
}

# replaces range value with average of range at given scale 
# e.g. 5-10 hours to 7.5*60 minutes
scale_and_avg_range <- function(df, to_match, scale) {
  matcher <- paste(to_match, collapse = "|")
  cond <- grepl(matcher, df)
  stripped_rows <- str_remove_all(df[cond], to_match)
  table <- read.table(text = stripped_rows, sep = "-", header = FALSE) * scale
  df[cond] <- rowMeans(table, na.rm = TRUE)
  return(df)
}
```

```{r}
hours <- c("hours", "hrs")
data$est_time <- scale_and_avg_range(data$est_time, hours, 60)
data$est_time <- strip_data(data$est_time)
data$est_time <- avg_range(data$est_time)
data <- data %>% mutate(est_time = as.numeric(est_time))

data$est_distance <- strip_data(data$est_distance)
data$est_distance <- avg_range(data$est_distance)
data <- data %>% mutate(est_distance = as.numeric(est_distance))

cents <- c("cents")
data$est_cost <- scale_data(data$est_cost, cents, 0.01)
data$est_cost <- strip_data(data$est_cost)
data$est_cost <- avg_range(data$est_cost)
data <- data %>% mutate(est_cost = as.numeric(est_cost))

data$distance <- strip_data(data$distance)
data <- data %>% mutate(distance = as.numeric(distance))

zeros <- c("Nothing", "None")
for (i in zeros) {
  data$cost <- sub(i, "0", data$cost)
}
data$cost <- gsub(
  "Less than a kilometre",
  paste(zeros, collapse = "|"),
  data$cost
  )
costs <- c("cent")
data$cost <- scale_data(data$cost, costs, 0.01)
data[3, 10] <- 0.8
data <- data %>% mutate(cost = as.numeric(cost))
```
